(function(q){"object"===typeof exports&&"undefined"!==typeof module?module.exports=q():"function"===typeof define&&define.amd?define([],q):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).dice=q()})(function(){return function(){function q(t,s,r){function e(c,b){if(!s[c]){if(!t[c]){var a="function"==typeof require&&require;if(!b&&a)return a(c,!0);if(n)return n(c,!0);a=Error("Cannot find module '"+c+"'");throw a.code="MODULE_NOT_FOUND",a;}a=
s[c]={exports:{}};t[c][0].call(a.exports,function(g){var a=t[c][1][g];return e(a?a:g)},a,a.exports,q,t,s,r)}return s[c].exports}for(var n="function"==typeof require&&require,b=0;b<r.length;b++)e(r[b]);return e}return q}()({1:[function(q,t,s){t.exports={name:"dice.js",version:"1.0.0",description:"A parser and evaluator for a useful rpg dice syntax.",main:"build/dice.js",directories:{test:"tests"},dependencies:{},devDependencies:{browserify:"~14.1.0","jasmine-core":"^2.5.2","jasmine-node":"~1.14.5",
karma:"~1.5.0","karma-chrome-launcher":"~2.0","karma-firefox-launcher":"~1.0.1","karma-jasmine":"~1.1","karma-phantomjs-launcher":"~1.0.4",pegjs:"~0.10.0"},scripts:{test:"make test"},repository:{type:"git",url:"https://github.com/lordnull/dice.js.git"},keywords:["rpg","dice","parser","roll","peg"],author:"Micah Warren (Lord Null)",license:"MIT",bugs:{url:"https://github.com/lordnull/dice.js/issues"},homepage:"https://github.com/lordnull/dice.js"}},{}],2:[function(q,t,s){function r(a,g){var k=c.parse(a);
return c.eval(k,g)}function e(a,g){if("static"==a.op)return[a.value,a.value];if("lookup"==a.op){var k=c.ops.lookup.call(a,g);return[k(g),k(g)]}if("floor"==a.op)return k=e(a.args[0],g),[Math.floor(k[0]),Math.floor(k[1])];if("ceil"==a.op)return k=e(a.args[0],g),[Math.ceil(k[0]),Math.ceil(k[1])];if("round"==a.op)return k=e(a.args[0],g),[Math.round(k[0]),Math.round(k[1])];if("d"==a.op){var b=e(a.args[0],g),h=e(a.args[1],g),k=h[0]*b[0],b=h[1]*b[1];return[k,b]}if("w"==a.op)return b=e(a.args[0],g),h=e(a.args[1],
g),k=h[0]*b[0],b=h[1]*b[1],[k,b];if("random"==a.op)return k=e(a.args[0],g),b=e(a.args[1],g),[k[0],b[1]];if("sum"==a.op)return b=a.addends.map(function(a){return[a[0],e(a[1],g)]}),h=b.shift(),k=b.reduce(function(g,a){return"+"===a[0]?g+a[1][0]:g-a[1][1]},h[1][0]),b=b.reduce(function(g,a){return"+"===a[0]?g+a[1][1]:g-a[1][0]},h[1][1]),[k,b];if("mult"==a.op)return b=a.multiplicants.map(function(a){return[a[0],e(a[1],g)]}),h=b.shift(),k=b.reduce(function(a,g){return"*"===g[0]?a*g[1][0]:a/g[1][1]},h[1][0]),
b=b.reduce(function(g,a){return"*"===a[0]?g*a[1][1]:g/a[1][0]},h[1][1]),[k,b];if("paren_express"==a.op)return e(a.args[0],g)}function n(a){var g=[];a.map(function(a){var c=a[0];a=b(a[1]);g.push(c);g.push(a)});g.shift();return g.join(" ")}function b(a){if(a.expression){var g=b(a.expression);a=a.op[0];"p"===a&&(a="");return a+"( "+g+" )"}if(a.op){if("sum"===a.op)a=n(a.addends);else if("mult"===a.op)a=n(a.multiplicants);else{var g=b(a.rightSide),c=b(a.leftSide);a=g+" "+a.op+" "+c}return a}return a.rolls?
a.x+a.mode+(1<a.min?a.min+"..":"")+a.max+":["+a.rolls.join(", ")+"]":a.toString()}var c={parse:q("./parser").parse,eval:q("./evaluate").eval,ops:q("./evaluate").ops,version:q("../package").version};c.roll=r;c.statistics=function(a,g,b){"number"==typeof g&&(b=g,g={});g=g||{};b=b||1E3;var h=[],l;for(l=0;l<b;l++)h.push(r(a,g));b=h.reduce(function(a,g){return a+g},0)/b;l=h.reduce(function(a,g){return a<g?a:g},h[0]);var n=h.reduce(function(a,g){return a>g?a:g},h[0]);a=c.parse(a);g=e(a,g);return{results:h,
mean:b,min:parseInt(l.toFixed()),max:parseInt(n.toFixed()),min_possible:g[0],max_possible:g[1]}};c.stringify=b;for(var h in c)s[h]=c[h]},{"../package":1,"./evaluate":3,"./parser":4}],3:[function(q,t,s){function r(b){var c=[];c[b]=!0;for(b=0;b<c.length;b++)c[b]=!0;return c}function e(b){var c;c=(c=b.args)||[];c=c.map(e);return n[b.op].apply(b,c)}var n={"static":function(){var b=this.value;return function(){return b}},lookup:function(){var b=this.value;return function(c){var e=c[b];if(void 0!=e)return e;
var a=b.split(".");return b==a?e:reduceRes=a.reduce(function(a,b){if(void 0!=a)return a[b]},c)}},floor:function(b){return function(c){c=b(c);var e=new Number(Math.floor(c));e.op="floor";e.expression=c;return e}},ceil:function(b){return function(c){c=b(c);var e=new Number(Math.ceil(c));e.op="ceil";e.expression=c;return e}},round:function(b){return function(c){c=b(c);var e=new Number(Math.round(c));e.op="round";e.expression=c;return e}},d:function(b,c){return function(e){var a=b(e),g,k,x=r(a-1).map(function(){var a=
c(e);g=a.min;k=a.max;return a}),l=x.reduce(function(a,g){return a+g},0),l=new Number(l);l.rolls=x;l.min=g;l.max=k;l.x=a;l.mode="d";return l}},w:function(b,c){return function(e){var a=b(e),g,k,x=r(a-1).map(function(){var a=c(e),b=0;g=c.min;k=c.max;if(c.min===c.max)return a;for(;a===c.max;)b+=a,a=mimMax(e);return b}),l=x.reduce(function(a,g){return a+g},0),l=new Number(l);l.rolls=x;l.min=g;l.max=k;l.x=a;l.mode="w";return l}},random:function(b,c){return function(e){var a=Math.random(),g=c(e);e=b(e);
a=Math.round((g-e)*a+e);a=new Number(a);a.min=e;a.max=g;return a}},mult:function(){var b=this.multiplicants,b=b.map(function(b){return[b[0],e(b[1])]});return function(e){var h=b.map(function(a){return[a[0],a[1](e)]}),a=h.reduce(function(a,b){return"*"===b[0]?a*b[1]:a/b[1]},1),a=new Number(a);a.op="mult";a.multiplicants=h;return a}},sum:function(){var b=this.addends,b=b.map(function(b){return[b[0],e(b[1])]});return function(e){var h=b.map(function(a){return[a[0],a[1](e)]}),a=h.reduce(function(a,b){return"+"===
b[0]?a+b[1]:a-b[1]},0),a=new Number(a);a.op="sum";a.addends=h;return a}},paren_express:function(b){return function(e){e=b(e);outtots=new Number(e);outtots.op="paren_express";outtots.expression=e;return outtots}}};s.eval=function(b,c){c=c||{};return e(b)(c)};s.ops=n},{}],4:[function(q,t,s){function r(e,n,b,c){this.message=e;this.expected=n;this.found=b;this.location=c;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,r)}(function(e,n){function b(){this.constructor=
e}b.prototype=n.prototype;e.prototype=new b})(r,Error);r.buildMessage=function(e,n){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}function c(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+b(a)})}function h(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,
"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+b(a)})}var a={literal:function(a){return'"'+c(a.text)+'"'},"class":function(a){var b="",e;for(e=0;e<a.parts.length;e++)b+=a.parts[e]instanceof Array?h(a.parts[e][0])+"-"+h(a.parts[e][1]):h(a.parts[e]);return"["+(a.inverted?"^":"")+b+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},
other:function(a){return a.description}};return"Expected "+function(b){var e=Array(b.length),c;for(c=0;c<b.length;c++)e[c]=a[b[c].type](b[c]);e.sort();if(0<e.length){for(b=c=1;c<e.length;c++)e[c-1]!==e[c]&&(e[b]=e[c],b++);e.length=b}switch(e.length){case 1:return e[0];case 2:return e[0]+" or "+e[1];default:return e.slice(0,-1).join(", ")+", or "+e[e.length-1]}}(e)+" but "+(n?'"'+c(n)+'"':"end of input")+" found."};t.exports={SyntaxError:r,parse:function(e,n){function b(a,d){return{type:"literal",
text:a,ignoreCase:d}}function c(a,d,b){return{type:"class",parts:a,inverted:d,ignoreCase:b}}function h(a){var d=z[a],b;if(!d){for(b=a-1;!z[b];)b--;d=z[b];for(d={line:d.line,column:d.column};b<a;)10===e.charCodeAt(b)?(d.line++,d.column=1):d.column++,b++;z[a]=d}return d}function a(a,d){var b=h(a),e=h(d);return{start:{offset:a,line:b.line,column:b.column},end:{offset:d,line:e.line,column:e.column}}}function g(a){f<v||(f>v&&(v=f,C=[]),C.push(a))}function k(){var a,b,e;a=f;b=u();b!==d?(b=q(),b!==d?(e=
u(),e!==d?a=b:(f=a,a=d)):(f=a,a=d)):(f=a,a=d);return a}function q(){var a;a=t();a===d&&(a=l());return a}function l(){var a,b,p;a=f;40===e.charCodeAt(f)?(b=R,f++):(b=d,0===m&&g(S));b!==d?(b=u(),b!==d?(b=q(),b!==d?(p=u(),p!==d?(41===e.charCodeAt(f)?(p=T,f++):(p=d,0===m&&g(U)),p!==d?a=b={op:"paren_express",args:[b]}:(f=a,a=d)):(f=a,a=d)):(f=a,a=d)):(f=a,a=d)):(f=a,a=d);return a}function s(){var a,b,p,c;a=f;b=D();b===d&&(b=l());b!==d?(p=f,c=u(),c!==d?(42===e.charCodeAt(f)?(c=V,f++):(c=d,0===m&&g(W)),
c!==d?(c=u(),c!==d?p="*":(f=p,p=d)):(f=p,p=d)):(f=p,p=d),p===d&&(p=f,c=u(),c!==d?(47===e.charCodeAt(f)?(c=X,f++):(c=d,0===m&&g(Y)),c!==d?(c=u(),c!==d?p="/":(f=p,p=d)):(f=p,p=d)):(f=p,p=d)),p!==d?(c=s(),c!==d?(a=c,"mult"!==a.op&&(a={op:"mult",multiplicants:[["*",a]]}),a.multiplicants[0][0]=p,a.multiplicants.unshift(["*",b])):(f=a,a=d)):(f=a,a=d)):(f=a,a=d);a===d&&(a=b=D(),a===d&&(a=b=l()));return a}function t(){var a,b,c,h;a=f;b=s();b!==d?(c=f,h=u(),h!==d?(43===e.charCodeAt(f)?(h=Z,f++):(h=d,0===m&&
g($)),h!==d?(h=u(),h!==d?c="+":(f=c,c=d)):(f=c,c=d)):(f=c,c=d),c===d&&(c=f,h=u(),h!==d?(45===e.charCodeAt(f)?(h=E,f++):(h=d,0===m&&g(F)),h!==d?(h=u(),h!==d?c="-":(f=c,c=d)):(f=c,c=d)):(f=c,c=d)),c!==d?(h=t(),h!==d?(a=h,"sum"!==a.op&&(a={op:"sum",addends:[["+",a]]}),a.addends[0][0]=c,a.addends.unshift(["+",b])):(f=a,a=d)):(f=a,a=d)):(f=a,a=d);a===d&&(a=b=s(),a===d&&(a=b=l()));return a}function D(){var a,b,e,c;a=f;b=y();b!==d?(e=G(),e!==d?(c=H(),c!==d?a=b={op:e,args:[b,c]}:(f=a,a=d)):(f=a,a=d)):(f=
a,a=d);a===d&&(a=f,b=G(),b!==d?(e=H(),e!==d?a=b={op:b,args:[{op:"static",value:1},e]}:(f=a,a=d)):(f=a,a=d),a===d&&(b=I(),b!==d&&(b={op:"d",args:[{op:"static",value:1},b]}),a=b,a===d&&(a=b=y())));return a}function G(){var a;100===e.charCodeAt(f)?(a=aa,f++):(a=d,0===m&&g(ba));a===d&&(119===e.charCodeAt(f)?(a=ca,f++):(a=d,0===m&&g(da)));return a}function H(){var a;a=I();a===d&&(a=y(),a!==d&&(a={op:"random",args:[{op:"static",args:[],value:1},a]}));return a}function I(){var a,b,c;a=f;b=y();b!==d?(e.substr(f,
2)===J?(c=J,f+=2):(c=d,0===m&&g(ea)),c!==d?(c=y(),c!==d?a=b={op:"random",args:[b,c]}:(f=a,a=d)):(f=a,a=d)):(f=a,a=d);return a}function u(){var a,b;a=[];K.test(e.charAt(f))?(b=e.charAt(f),f++):(b=d,0===m&&g(L));for(;b!==d;)a.push(b),K.test(e.charAt(f))?(b=e.charAt(f),f++):(b=d,0===m&&g(L));return a}function y(){var a,b,c;m++;c=[];A.test(e.charAt(f))?(b=e.charAt(f),f++):(b=d,0===m&&g(B));if(b!==d)for(;b!==d;)c.push(b),A.test(e.charAt(f))?(b=e.charAt(f),f++):(b=d,0===m&&g(B));else c=d;c!==d&&(c=parseInt(c.join(""),
10));a=c;if(a===d)if(a=f,45===e.charCodeAt(f)?(c=E,f++):(c=d,0===m&&g(F)),c!==d){b=[];A.test(e.charAt(f))?(c=e.charAt(f),f++):(c=d,0===m&&g(B));if(c!==d)for(;c!==d;)b.push(c),A.test(e.charAt(f))?(c=e.charAt(f),f++):(c=d,0===m&&g(B));else b=d;b!==d?a=c=-1*parseInt(b.join(""),10):(f=a,a=d)}else f=a,a=d;m--;a===d&&0===m&&g(fa);b=a;b!==d&&(b={op:"static",value:b});a=b;a===d&&(a=b=M(),a===d&&(a=f,b=N(),b!==d?(c=M(),c!==d?a=b={op:b,args:[c]}:(f=a,a=d)):(f=a,a=d),a===d&&(a=f,b=N(),b!==d?(c=l(),c!==d?a=b=
{op:b,args:c.args}:(f=a,a=d)):(f=a,a=d))));return a}function N(){var a;102===e.charCodeAt(f)?(a=ga,f++):(a=d,0===m&&g(ha));a!==d&&(a="floor");a===d&&(114===e.charCodeAt(f)?(a=ia,f++):(a=d,0===m&&g(ja)),a!==d&&(a="round"),a===d&&(99===e.charCodeAt(f)?(a=ka,f++):(a=d,0===m&&g(la)),a!==d&&(a="ceil")));return a}function M(){var a,b,c;a=f;91===e.charCodeAt(f)?(b=ma,f++):(b=d,0===m&&g(na));if(b!==d){b=[];O.test(e.charAt(f))?(c=e.charAt(f),f++):(c=d,0===m&&g(P));if(c!==d)for(;c!==d;)b.push(c),O.test(e.charAt(f))?
(c=e.charAt(f),f++):(c=d,0===m&&g(P));else b=d;b!==d?(93===e.charCodeAt(f)?(c=oa,f++):(c=d,0===m&&g(pa)),c!==d?a=b=b.join(""):(f=a,a=d)):(f=a,a=d)}else f=a,a=d;a!==d&&(a={op:"lookup",value:a});return a}n=void 0!==n?n:{};var d={},w={start:k},Q=k,R="(",S=b("(",!1),T=")",U=b(")",!1),V="*",W=b("*",!1),X="/",Y=b("/",!1),Z="+",$=b("+",!1),E="-",F=b("-",!1),aa="d",ba=b("d",!1),ca="w",da=b("w",!1),J="..",ea=b("..",!1),K=/^[ ]/,L=c([" "],!1,!1),ga="f",ha=b("f",!1),ia="r",ja=b("r",!1),ka="c",la=b("c",!1),ma=
"[",na=b("[",!1),O=/^[^[\]]/,P=c(["[","]"],!0,!1),oa="]",pa=b("]",!1),fa={type:"other",description:"integer"},A=/^[0-9]/,B=c([["0","9"]],!1,!1),f=0,z=[{line:1,column:1}],v=0,C=[],m=0;if("startRule"in n){if(!(n.startRule in w))throw Error("Can't start parsing from rule \""+n.startRule+'".');Q=w[n.startRule]}w=Q();if(w!==d&&f===e.length)return w;w!==d&&f<e.length&&g({type:"end"});throw function(a,b,c){return new r(r.buildMessage(a,b),a,b,c)}(C,v<e.length?e.charAt(v):null,v<e.length?a(v,v+1):a(v,v));
}}},{}]},{},[2])(2)});
