dice={version:"0.5.0",roll:function(k,m){var e=dice.parse.parse(dice.correctInput(k));return dice.eval.eval(e,m)},correctInput:function(k){k.charAt(0).match(/[dw]/i)&&(k=1+k);for(var m;null!==(m=k.match(/\D[dw]\d*/i));)m=m.toString(),m=m.charAt(0)+1+m.substring(1,m.length),k=k.replace(/\D[dw]\d*/i,m);return k=k.replace(/D/g,"d").replace(/W/g,"w")},stringify_expression:function(k){var m=dice.stringify(k.expression);k=k.op[0];"p"===k&&(k="");return k+"( "+m+" )"},stringify_op:function(k){var m=dice.stringify(k.rightSide),
e=dice.stringify(k.leftSide);return m+" "+k.op+" "+e},stringify_rolls:function(k){return k.x+k.mode+(1<k.min?k.min+"..":"")+k.max+":["+k.rolls.join(", ")+"]"},stringify:function(k){return k.expression?dice.stringify_expression(k):k.op?dice.stringify_op(k):k.rolls?dice.stringify_rolls(k):k.toString()}};
dice.parse=function(){function k(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var m={parse:function(e,g){function b(a){var c={},b;for(b in a)c[b]=a[b];return c}function d(a,c){for(var b=a.offset+c,d=a.offset;d<b;d++){var h=e.charAt(d);"\n"===h?(a.seenCR||a.line++,a.column=1,a.seenCR=!1):"\r"===h||"\u2028"===h||"\u2029"===
h?(a.line++,a.column=1,a.seenCR=!0):(a.column++,a.seenCR=!1)}a.offset+=c}function n(a){c.offset<w.offset||(c.offset>w.offset&&(w=b(c),z=[]),z.push(a))}function v(){var a,f,d,l,h;l=b(c);h=b(c);a=q();null!==a?(f=A(),null!==f?(d=y(),null!==d?a=[a,f,d]:(a=null,c=b(h))):(a=null,c=b(h))):(a=null,c=b(h));null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===a&&(c=b(l));null===a&&(l=b(c),a=y(),null===a&&(c=b(l)),null===a&&(l=b(c),a=m(),null===a&&(c=b(l))));return a}function m(){var a,f,r,l,h,g,k;g=b(c);k=b(c);
40===e.charCodeAt(c.offset)?(a="(",d(c,1)):(a=null,0===p&&n('"("'));null!==a?(f=s(),null!==f?(r=v(),null!==r?(l=s(),null!==l?(41===e.charCodeAt(c.offset)?(h=")",d(c,1)):(h=null,0===p&&n('")"')),null!==h?a=[a,f,r,l,h]:(a=null,c=b(k))):(a=null,c=b(k))):(a=null,c=b(k))):(a=null,c=b(k))):(a=null,c=b(k));null!==a&&(a={op:"paren_express",args:[a[2]]});null===a&&(c=b(g));return a}function t(){var a,f,r,l,h;l=b(c);h=b(c);a=s();null!==a?(42===e.charCodeAt(c.offset)?(f="*",d(c,1)):(f=null,0===p&&n('"*"')),
null!==f?(r=s(),null!==r?a=[a,f,r]:(a=null,c=b(h))):(a=null,c=b(h))):(a=null,c=b(h));null!==a&&(a="*");null===a&&(c=b(l));null===a&&(l=b(c),h=b(c),a=s(),null!==a?(47===e.charCodeAt(c.offset)?(f="/",d(c,1)):(f=null,0===p&&n('"/"')),null!==f?(r=s(),null!==r?a=[a,f,r]:(a=null,c=b(h))):(a=null,c=b(h))):(a=null,c=b(h)),null!==a&&(a="/"),null===a&&(c=b(l)));return a}function q(){var a,f,d,l,h;l=b(c);h=b(c);a=B();null!==a?(f=t(),null!==f?(d=q(),null!==d?a=[a,f,d]:(a=null,c=b(h))):(a=null,c=b(h))):(a=null,
c=b(h));null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===a&&(c=b(l));null===a&&(l=b(c),h=b(c),a=m(),null!==a?(f=t(),null!==f?(d=q(),null!==d?a=[a,f,d]:(a=null,c=b(h))):(a=null,c=b(h))):(a=null,c=b(h)),null!==a&&(a={op:a[1],args:[a[0],a[2]]}),null===a&&(c=b(l)),null===a&&(l=b(c),a=B(),null===a&&(c=b(l)),null===a&&(l=b(c),a=m(),null===a&&(c=b(l)))));return a}function y(){var a,f,d,l,h;l=b(c);h=b(c);a=q();null!==a?(f=A(),null!==f?(d=y(),null!==d?a=[a,f,d]:(a=null,c=b(h))):(a=null,c=b(h))):(a=null,c=b(h));
null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===a&&(c=b(l));null===a&&(l=b(c),a=q(),null===a&&(c=b(l)),null===a&&(l=b(c),a=m(),null===a&&(c=b(l))));return a}function A(){var a,f,r,l,h;l=b(c);h=b(c);a=s();null!==a?(43===e.charCodeAt(c.offset)?(f="+",d(c,1)):(f=null,0===p&&n('"+"')),null!==f?(r=s(),null!==r?a=[a,f,r]:(a=null,c=b(h))):(a=null,c=b(h))):(a=null,c=b(h));null!==a&&(a="+");null===a&&(c=b(l));null===a&&(l=b(c),h=b(c),a=s(),null!==a?(45===e.charCodeAt(c.offset)?(f="-",d(c,1)):(f=null,0===p&&
n('"-"')),null!==f?(r=s(),null!==r?a=[a,f,r]:(a=null,c=b(h))):(a=null,c=b(h))):(a=null,c=b(h)),null!==a&&(a="-"),null===a&&(c=b(l)));return a}function B(){var a,f,d,l,h;l=b(c);h=b(c);a=x();null!==a?(f=C(),null!==f?(d=D(),null!==d?a=[a,f,d]:(a=null,c=b(h))):(a=null,c=b(h))):(a=null,c=b(h));null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===a&&(c=b(l));null===a&&(l=b(c),h=b(c),a=C(),null!==a?(f=D(),null!==f?a=[a,f]:(a=null,c=b(h))):(a=null,c=b(h)),null!==a&&(a={op:a[0],args:[1,a[1]]}),null===a&&(c=b(l)),
null===a&&(l=b(c),a=E(),null!==a&&(a={op:"d",args:[{op:"static",value:1},a]}),null===a&&(c=b(l)),null===a&&(l=b(c),a=x(),null===a&&(c=b(l)))));return a}function C(){var a;100===e.charCodeAt(c.offset)?(a="d",d(c,1)):(a=null,0===p&&n('"d"'));null===a&&(119===e.charCodeAt(c.offset)?(a="w",d(c,1)):(a=null,0===p&&n('"w"')));return a}function D(){var a,f;f=b(c);a=E();null===a&&(c=b(f));null===a&&(f=b(c),a=x(),null!==a&&(a={op:"random",args:[{op:"static",args:[],value:1},a]}),null===a&&(c=b(f)));return a}
function E(){var a,f,r,l,h;l=b(c);h=b(c);a=x();null!==a?(".."===e.substr(c.offset,2)?(f="..",d(c,2)):(f=null,0===p&&n('".."')),null!==f?(r=x(),null!==r?a=[a,f,r]:(a=null,c=b(h))):(a=null,c=b(h))):(a=null,c=b(h));null!==a&&(a={op:"random",args:[a[0],a[2]]});null===a&&(c=b(l));return a}function s(){var a,b;a=[];/^[ ]/.test(e.charAt(c.offset))?(b=e.charAt(c.offset),d(c,1)):(b=null,0===p&&n("[ ]"));for(;null!==b;)a.push(b),/^[ ]/.test(e.charAt(c.offset))?(b=e.charAt(c.offset),d(c,1)):(b=null,0===p&&n("[ ]"));
return a}function x(){var a,d,e,l;e=b(c);a=H();null!==a&&(a={op:"static",value:a});null===a&&(c=b(e));null===a&&(e=b(c),a=F(),null===a&&(c=b(e)),null===a&&(e=b(c),l=b(c),a=G(),null!==a?(d=F(),null!==d?a=[a,d]:(a=null,c=b(l))):(a=null,c=b(l)),null!==a&&(a={op:a[0],args:[a[1]]}),null===a&&(c=b(e)),null===a&&(e=b(c),l=b(c),a=G(),null!==a?(d=m(),null!==d?a=[a,d]:(a=null,c=b(l))):(a=null,c=b(l)),null!==a&&(a={op:a[0],args:a[1].args}),null===a&&(c=b(e)))));return a}function G(){var a,f;f=b(c);102===e.charCodeAt(c.offset)?
(a="f",d(c,1)):(a=null,0===p&&n('"f"'));null!==a&&(a="floor");null===a&&(c=b(f));null===a&&(f=b(c),114===e.charCodeAt(c.offset)?(a="r",d(c,1)):(a=null,0===p&&n('"r"')),null!==a&&(a="round"),null===a&&(c=b(f)),null===a&&(f=b(c),99===e.charCodeAt(c.offset)?(a="c",d(c,1)):(a=null,0===p&&n('"c"')),null!==a&&(a="ceil"),null===a&&(c=b(f))));return a}function F(){var a,d;d=b(c);a=I();null!==a&&(a={op:"lookup",value:a});null===a&&(c=b(d));return a}function I(){var a,f,g,l,h;l=b(c);h=b(c);91===e.charCodeAt(c.offset)?
(a="[",d(c,1)):(a=null,0===p&&n('"["'));if(null!==a){/^[a-zA-Z 0-9]/.test(e.charAt(c.offset))?(g=e.charAt(c.offset),d(c,1)):(g=null,0===p&&n("[a-zA-Z 0-9]"));if(null!==g)for(f=[];null!==g;)f.push(g),/^[a-zA-Z 0-9]/.test(e.charAt(c.offset))?(g=e.charAt(c.offset),d(c,1)):(g=null,0===p&&n("[a-zA-Z 0-9]"));else f=null;null!==f?(93===e.charCodeAt(c.offset)?(g="]",d(c,1)):(g=null,0===p&&n('"]"')),null!==g?a=[a,f,g]:(a=null,c=b(h))):(a=null,c=b(h))}else a=null,c=b(h);null!==a&&(a=a[1].join(""));null===a&&
(c=b(l));return a}function H(){var a,f,g,l,h;p++;l=b(c);/^[0-9]/.test(e.charAt(c.offset))?(f=e.charAt(c.offset),d(c,1)):(f=null,0===p&&n("[0-9]"));if(null!==f)for(a=[];null!==f;)a.push(f),/^[0-9]/.test(e.charAt(c.offset))?(f=e.charAt(c.offset),d(c,1)):(f=null,0===p&&n("[0-9]"));else a=null;null!==a&&(a=parseInt(a.join(""),10));null===a&&(c=b(l));if(null===a){l=b(c);h=b(c);45===e.charCodeAt(c.offset)?(a="-",d(c,1)):(a=null,0===p&&n('"-"'));if(null!==a){/^[0-9]/.test(e.charAt(c.offset))?(g=e.charAt(c.offset),
d(c,1)):(g=null,0===p&&n("[0-9]"));if(null!==g)for(f=[];null!==g;)f.push(g),/^[0-9]/.test(e.charAt(c.offset))?(g=e.charAt(c.offset),d(c,1)):(g=null,0===p&&n("[0-9]"));else f=null;null!==f?a=[a,f]:(a=null,c=b(h))}else a=null,c=b(h);null!==a&&(a=-1*parseInt(a[1].join(""),10));null===a&&(c=b(l))}p--;0===p&&null===a&&n("integer");return a}function K(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}var u={dicerolls:v,parenExpress:m,multiplicationOp:t,multiplicationSeq:q,
additionSeq:y,additionOp:A,diceroll:B,rollmode:C,maybe_minmax:D,minmax:E,ws:s,intval:x,mathit:G,lookup:F,variable:I,integer:H};if(void 0!==g){if(void 0===u[g])throw Error("Invalid rule name: "+k(g)+".");}else g="dicerolls";var c={offset:0,line:1,column:1,seenCR:!1},p=0,w={offset:0,line:1,column:1,seenCR:!1},z=[],u=u[g]();if(null===u||c.offset!==e.length){var u=Math.max(c.offset,w.offset),L=u<e.length?e.charAt(u):null,J=c.offset>w.offset?c:w;throw new this.SyntaxError(K(z),L,u,J.line,J.column);}return u},
toSource:function(){return this._source},SyntaxError:function(e,g,b,d,n){this.name="SyntaxError";this.expected=e;this.found=g;switch(e.length){case 0:e="end of input";break;case 1:e=e[0];break;default:e=e.slice(0,e.length-1).join(", ")+" or "+e[e.length-1]}g=g?k(g):"end of input";this.message="Expected "+e+" but "+g+" found.";this.offset=b;this.line=d;this.column=n}};m.SyntaxError.prototype=Error.prototype;return m}();
dice.eval=function(){function k(g){var b=[];b[g]=!0;for(g=0;g<b.length;g++)b[g]=!0;return b}function m(g){var b;b=(b=g.args)||[];b=b.map(m);return e[g.op].apply(g,b)}var e={"static":function(){var g=this.value;return function(){return g}},lookup:function(){var g=this.value;return function(b){return b[g]}},floor:function(g){return function(b){b=g(b);var d=new Number(Math.floor(b));d.op="floor";d.expression=b;return d}},ceil:function(g){return function(b){b=g(b);var d=new Number(Math.ceil(b));d.op=
"ceil";d.expression=b;return d}},round:function(g){return function(b){b=g(b);var d=new Number(Math.round(b));d.op="round";d.expression=b;return d}},d:function(g,b){return function(d){var e=g(d),v,m,t=k(e-1).map(function(){var g=b(d);v=g.min;m=g.max;return g}),q=t.reduce(function(b,d){return b+d},0),q=new Number(q);q.rolls=t;q.min=v;q.max=m;q.x=e;q.mode="d";return q}},w:function(g,b){return function(d){var e=g(d),v,m,t=k(e-1).map(function(){var g=b(d),e=0;v=b.min;m=b.max;if(b.min===b.max)return g;
for(;g===b.max;)e+=g,g=mimMax(d);return e}),q=t.reduce(function(b,d){return b+d},0),q=new Number(q);q.rolls=t;q.min=v;q.max=m;q.x=e;q.mode="w";return q}},random:function(g,b){return function(d){var e=Math.random(),k=b(d);d=g(d);e=Math.round((k-d)*e+d);e=new Number(e);e.min=d;e.max=k;return e}},"+":function(e,b){return function(d){var k=e(d);d=b(d);var m;m=new Number(k+d);m.op="+";m.rightSide=k;m.leftSide=d;return m}},"-":function(e,b){return function(d){var k=e(d);d=b(d);var m;m=new Number(k-d);m.op=
"-";m.rightSide=k;m.leftSide=d;return m}},"*":function(e,b){return function(d){var k=e(d);d=b(d);var m;m=new Number(k*d);m.op="*";m.rightSide=k;m.leftSide=d;return m}},"/":function(e,b){return function(d){var k=e(d);d=b(d);var m;m=new Number(k/d);m.op="/";m.rightSide=k;m.leftSide=d;return m}},paren_express:function(e){return function(b){b=e(b);outtots=new Number(b);outtots.op="paren_express";outtots.expression=b;return outtots}}};return{eval:function(e,b){b=b||{};return m(e)(b)},ops:e}}();
