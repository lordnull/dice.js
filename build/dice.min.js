dice={version:"0.4.0",roll:function(m,q){var d=dice.parse.parse(m);return dice.eval.eval(d,q)},stringify_op:function(m){var q=dice.stringify(m.rightSide),d=dice.stringify(m.leftSide);return q+" "+m.op+" "+d},stringify_rolls:function(m){return m.x+m.mode+(1<m.min?m.min+"..":"")+m.max+":["+m.rolls.join(", ")+"]"},stringify:function(m){return m.op?dice.stringify_op(m):m.rolls?dice.stringify_rolls(m):m.toString()}};
dice.parse=function(){function m(d){return'"'+d.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var q={parse:function(d,h){function c(a){var b={},c;for(c in a)b[c]=a[c];return b}function e(a,b){for(var c=a.offset+b,e=a.offset;e<c;e++){var g=d.charAt(e);"\n"===g?(a.seenCR||a.line++,a.column=1,a.seenCR=!1):"\r"===g||"\u2028"===g||"\u2029"===
g?(a.line++,a.column=1,a.seenCR=!0):(a.column++,a.seenCR=!1)}a.offset+=b}function k(a){b.offset<v.offset||(b.offset>v.offset&&(v=c(b),z=[]),z.push(a))}function l(){var a,f,r,y,g;y=c(b);g=c(b);a=t();null!==a?(42===d.charCodeAt(b.offset)?(f="*",e(b,1)):(f=null,0===n&&k('"*"')),null!==f?(r=t(),null!==r?a=[a,f,r]:(a=null,b=c(g))):(a=null,b=c(g))):(a=null,b=c(g));null!==a&&(a="*");null===a&&(b=c(y));null===a&&(y=c(b),g=c(b),a=t(),null!==a?(47===d.charCodeAt(b.offset)?(f="/",e(b,1)):(f=null,0===n&&k('"/"')),
null!==f?(r=t(),null!==r?a=[a,f,r]:(a=null,b=c(g))):(a=null,b=c(g))):(a=null,b=c(g)),null!==a&&(a="/"),null===a&&(b=c(y)));return a}function x(){var a,f,e,d,g;d=c(b);g=c(b);a=A();null!==a?(f=l(),null!==f?(e=x(),null!==e?a=[a,f,e]:(a=null,b=c(g))):(a=null,b=c(g))):(a=null,b=c(g));null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===a&&(b=c(d));null===a&&(d=c(b),a=A(),null===a&&(b=c(d)));return a}function s(){var a,f,e,d,g;d=c(b);g=c(b);a=x();null!==a?(f=p(),null!==f?(e=s(),null!==e?a=[a,f,e]:(a=null,b=
c(g))):(a=null,b=c(g))):(a=null,b=c(g));null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===a&&(b=c(d));null===a&&(d=c(b),a=x(),null===a&&(b=c(d)));return a}function p(){var a,f,r,h,g;h=c(b);g=c(b);a=t();null!==a?(43===d.charCodeAt(b.offset)?(f="+",e(b,1)):(f=null,0===n&&k('"+"')),null!==f?(r=t(),null!==r?a=[a,f,r]:(a=null,b=c(g))):(a=null,b=c(g))):(a=null,b=c(g));null!==a&&(a="+");null===a&&(b=c(h));null===a&&(h=c(b),g=c(b),a=t(),null!==a?(45===d.charCodeAt(b.offset)?(f="-",e(b,1)):(f=null,0===n&&k('"-"')),
null!==f?(r=t(),null!==r?a=[a,f,r]:(a=null,b=c(g))):(a=null,b=c(g))):(a=null,b=c(g)),null!==a&&(a="-"),null===a&&(b=c(h)));return a}function A(){var a,f,e,d,g;d=c(b);g=c(b);a=w();null!==a?(f=B(),null!==f?(e=q(),null!==e?a=[a,f,e]:(a=null,b=c(g))):(a=null,b=c(g))):(a=null,b=c(g));null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===a&&(b=c(d));null===a&&(d=c(b),g=c(b),a=B(),null!==a?(f=q(),null!==f?a=[a,f]:(a=null,b=c(g))):(a=null,b=c(g)),null!==a&&(a={op:a[0],args:[1,a[1]]}),null===a&&(b=c(d)),null===
a&&(d=c(b),a=C(),null!==a&&(a={op:"d",args:[{op:"static",value:1},a]}),null===a&&(b=c(d)),null===a&&(d=c(b),a=w(),null===a&&(b=c(d)))));return a}function B(){var a;100===d.charCodeAt(b.offset)?(a="d",e(b,1)):(a=null,0===n&&k('"d"'));null===a&&(119===d.charCodeAt(b.offset)?(a="w",e(b,1)):(a=null,0===n&&k('"w"')));return a}function q(){var a,f;f=c(b);a=C();null===a&&(b=c(f));null===a&&(f=c(b),a=w(),null!==a&&(a={op:"random",args:[{op:"static",args:[],value:1},a]}),null===a&&(b=c(f)));return a}function C(){var a,
f,h,l,g;l=c(b);g=c(b);a=w();null!==a?(".."===d.substr(b.offset,2)?(f="..",e(b,2)):(f=null,0===n&&k('".."')),null!==f?(h=w(),null!==h?a=[a,f,h]:(a=null,b=c(g))):(a=null,b=c(g))):(a=null,b=c(g));null!==a&&(a={op:"random",args:[a[0],a[2]]});null===a&&(b=c(l));return a}function t(){var a,c;a=[];/^[ ]/.test(d.charAt(b.offset))?(c=d.charAt(b.offset),e(b,1)):(c=null,0===n&&k("[ ]"));for(;null!==c;)a.push(c),/^[ ]/.test(d.charAt(b.offset))?(c=d.charAt(b.offset),e(b,1)):(c=null,0===n&&k("[ ]"));return a}function w(){var a,
f,e,d;e=c(b);a=E();null!==a&&(a={op:"static",value:a});null===a&&(b=c(e));null===a&&(e=c(b),a=D(),null===a&&(b=c(e)),null===a&&(e=c(b),d=c(b),a=F(),null!==a?(f=D(),null!==f?a=[a,f]:(a=null,b=c(d))):(a=null,b=c(d)),null!==a&&(a={op:a[0],args:[a[1]]}),null===a&&(b=c(e))));return a}function F(){var a,f;f=c(b);102===d.charCodeAt(b.offset)?(a="f",e(b,1)):(a=null,0===n&&k('"f"'));null!==a&&(a="floor");null===a&&(b=c(f));null===a&&(f=c(b),114===d.charCodeAt(b.offset)?(a="r",e(b,1)):(a=null,0===n&&k('"r"')),
null!==a&&(a="round"),null===a&&(b=c(f)),null===a&&(f=c(b),99===d.charCodeAt(b.offset)?(a="c",e(b,1)):(a=null,0===n&&k('"c"')),null!==a&&(a="ceil"),null===a&&(b=c(f))));return a}function D(){var a,e;e=c(b);a=G();null!==a&&(a={op:"lookup",value:a});null===a&&(b=c(e));return a}function G(){var a,f,h,l,g;l=c(b);g=c(b);91===d.charCodeAt(b.offset)?(a="[",e(b,1)):(a=null,0===n&&k('"["'));if(null!==a){/^[a-zA-Z 0-9]/.test(d.charAt(b.offset))?(h=d.charAt(b.offset),e(b,1)):(h=null,0===n&&k("[a-zA-Z 0-9]"));
if(null!==h)for(f=[];null!==h;)f.push(h),/^[a-zA-Z 0-9]/.test(d.charAt(b.offset))?(h=d.charAt(b.offset),e(b,1)):(h=null,0===n&&k("[a-zA-Z 0-9]"));else f=null;null!==f?(93===d.charCodeAt(b.offset)?(h="]",e(b,1)):(h=null,0===n&&k('"]"')),null!==h?a=[a,f,h]:(a=null,b=c(g))):(a=null,b=c(g))}else a=null,b=c(g);null!==a&&(a=a[1].join(""));null===a&&(b=c(l));return a}function E(){var a,f,h,l,g;n++;l=c(b);/^[0-9]/.test(d.charAt(b.offset))?(f=d.charAt(b.offset),e(b,1)):(f=null,0===n&&k("[0-9]"));if(null!==
f)for(a=[];null!==f;)a.push(f),/^[0-9]/.test(d.charAt(b.offset))?(f=d.charAt(b.offset),e(b,1)):(f=null,0===n&&k("[0-9]"));else a=null;null!==a&&(a=parseInt(a.join(""),10));null===a&&(b=c(l));if(null===a){l=c(b);g=c(b);45===d.charCodeAt(b.offset)?(a="-",e(b,1)):(a=null,0===n&&k('"-"'));if(null!==a){/^[0-9]/.test(d.charAt(b.offset))?(h=d.charAt(b.offset),e(b,1)):(h=null,0===n&&k("[0-9]"));if(null!==h)for(f=[];null!==h;)f.push(h),/^[0-9]/.test(d.charAt(b.offset))?(h=d.charAt(b.offset),e(b,1)):(h=null,
0===n&&k("[0-9]"));else f=null;null!==f?a=[a,f]:(a=null,b=c(g))}else a=null,b=c(g);null!==a&&(a=-1*parseInt(a[1].join(""),10));null===a&&(b=c(l))}n--;0===n&&null===a&&k("integer");return a}function I(a){a.sort();for(var b=null,c=[],e=0;e<a.length;e++)a[e]!==b&&(c.push(a[e]),b=a[e]);return c}var u={dicerolls:function(){var a,e,d,h,g;h=c(b);g=c(b);a=x();null!==a?(e=p(),null!==e?(d=s(),null!==d?a=[a,e,d]:(a=null,b=c(g))):(a=null,b=c(g))):(a=null,b=c(g));null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===
a&&(b=c(h));null===a&&(h=c(b),a=s(),null===a&&(b=c(h)));return a},multiplicationOp:l,multiplicationSeq:x,additionSeq:s,additionOp:p,diceroll:A,rollmode:B,maybe_minmax:q,minmax:C,ws:t,intval:w,mathit:F,lookup:D,variable:G,integer:E};if(void 0!==h){if(void 0===u[h])throw Error("Invalid rule name: "+m(h)+".");}else h="dicerolls";var b={offset:0,line:1,column:1,seenCR:!1},n=0,v={offset:0,line:1,column:1,seenCR:!1},z=[],u=u[h]();if(null===u||b.offset!==d.length){var u=Math.max(b.offset,v.offset),J=u<d.length?
d.charAt(u):null,H=b.offset>v.offset?b:v;throw new this.SyntaxError(I(z),J,u,H.line,H.column);}return u},toSource:function(){return this._source},SyntaxError:function(d,h,c,e,k){this.name="SyntaxError";this.expected=d;this.found=h;switch(d.length){case 0:d="end of input";break;case 1:d=d[0];break;default:d=d.slice(0,d.length-1).join(", ")+" or "+d[d.length-1]}h=h?m(h):"end of input";this.message="Expected "+d+" but "+h+" found.";this.offset=c;this.line=e;this.column=k}};q.SyntaxError.prototype=Error.prototype;
return q}();
dice.eval=function(){function m(d){var c=[];c[d]=!0;for(d=0;d<c.length;d++)c[d]=!0;return c}function q(h){var c;c=(c=h.args)||[];c=c.map(q);return d[h.op].apply(h,c)}var d={"static":function(){var d=this.value;return function(){return d}},lookup:function(){var d=this.value;return function(c){return c[d]}},floor:function(d){return function(c){return Math.floor(d(c))}},ceil:function(d){return function(c){return Math.ceil(d(c))}},round:function(d){return function(c){return Math.round(d(c))}},d:function(d,
c){return function(e){var k=d(e),l,q,s=m(k-1).map(function(){var d=c(e);l=d.min;q=d.max;return d}),p=s.reduce(function(c,d){return c+d},0),p=new Number(p);p.rolls=s;p.min=l;p.max=q;p.x=k;p.mode="d";return p}},w:function(d,c){return function(e){var k=d(e),l,q,s=m(k-1).map(function(){var d=c(e),h=0;l=c.min;q=c.max;if(c.min===c.max)return d;for(;d===c.max;)h+=d,d=mimMax(e);return h}),p=s.reduce(function(c,d){return c+d},0),p=new Number(p);p.rolls=s;p.min=l;p.max=q;p.x=k;p.mode="w";return p}},random:function(d,
c){return function(e){var k=Math.random(),l=c(e);e=d(e);k=Math.round((l-e)*k+e);k=new Number(k);k.min=e;k.max=l;return k}},"+":function(d,c){return function(e){var k=d(e);e=c(e);var l;l=new Number(k+e);l.op="+";l.rightSide=k;l.leftSide=e;return l}},"-":function(d,c){return function(e){var k=d(e);e=c(e);var l;l=new Number(k-e);l.op="-";l.rightSide=k;l.leftSide=e;return l}},"*":function(d,c){return function(e){var k=d(e);e=c(e);var l;l=new Number(k*e);l.op="*";l.rightSide=k;l.leftSide=e;return l}},
"/":function(d,c){return function(e){var k=d(e);e=c(e);var l;l=new Number(k/e);l.op="/";l.rightSide=k;l.leftSide=e;return l}}};return{eval:function(d,c){c=c||{};return q(d)(c)},ops:d}}();
